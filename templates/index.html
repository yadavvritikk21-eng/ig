<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U·¥ä·¥ä·¥ú ùêí·¥ò·¥Ä·¥çùê¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #e0e0ff;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            background: rgba(255,255,255,0.07);
            border-radius: 20px;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.12);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .btn-spam {
            background: linear-gradient(90deg, #ff006e, #8338ec);
            border: none;
            padding: 14px 40px;
            border-radius: 50px;
            font-weight: 700;
            transition: all 0.3s;
        }
        .btn-spam:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(131,56,236,0.5);
        }
        .console {
            background: #0a0a0a;
            color: #00ff41;
            font-family: 'Courier New', Consolas, monospace;
            padding: 16px;
            border-radius: 12px;
            height: 420px;
            overflow-y: auto;
            border: 1px solid #1a3a1a;
            white-space: pre-wrap;
            line-height: 1.45;
        }
        .console::-webkit-scrollbar {
            width: 8px;
        }
        .console::-webkit-scrollbar-thumb {
            background: #00ff41;
            border-radius: 4px;
        }
        .status-badge {
            font-size: 1.1rem;
            padding: 10px 20px;
        }
        .error-alert {
            margin-bottom: 1.5rem;
        }
        .form-label {
            color: #a0d0ff;
        }
        textarea.form-control, input.form-control {
            background: rgba(30,30,60,0.7);
            border: 1px solid #444466;
            color: #e0e0ff;
        }
        textarea.form-control:focus, input.form-control:focus {
            border-color: #8338ec;
            box-shadow: 0 0 0 0.25rem rgba(131,56,236,0.25);
        }
    </style>
</head>
<body class="p-3 p-md-4">
    <div class="container">
        <h1 class="text-center display-4 mb-4 fw-bold">ùêî·¥ä·¥ä·¥ú ùêí·¥ò·¥Ä·¥çùê¨</h1>

        <div class="text-center mb-4">
            <span class="badge bg-dark status-badge">{{ text }}</span>
            <span class="badge bg-success status-badge ms-2">SENT: {{ sent }}</span>
            <span class="badge bg-info status-badge ms-2">THREADS: {{ threads }}</span>
        </div>

        {% if error %}
        <div class="alert alert-danger error-alert" role="alert">
            <strong>Error:</strong> {{ error }}
        </div>
        {% endif %}

        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-7">

                <div class="card p-4 mb-4 shadow-lg">
                    <form method="POST" id="spamForm">
                        <div class="mb-4">
                            <label class="form-label fw-bold">Mode</label>
                            <select name="mode" class="form-select form-select-lg" onchange="toggleMode()">
                                <option value="session" {% if cfg.mode == 'session' %}selected{% endif %}>Session ID (recommended)</option>
                                <option value="username" {% if cfg.mode == 'username' %}selected{% endif %}>Username + Password</option>
                            </select>
                        </div>

                        <div id="session-field" {% if cfg.mode != 'session' %}style="display:none;"{% endif %}>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Session ID #1 <span class="text-danger">(required)</span></label>
                                <textarea name="sessionid1" class="form-control" rows="2" required
                                          placeholder="67123456789%3Aabc123xyz... long string from browser cookies">{{ cfg.sessionid1 }}</textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Session ID #2 <span class="text-muted">(optional)</span></label>
                                <textarea name="sessionid2" class="form-control" rows="2"
                                          placeholder="Leave empty to use only first account">{{ cfg.sessionid2 }}</textarea>
                            </div>
                            <small class="text-info d-block mb-3">
                                How to get: Instagram Web ‚Üí F12 ‚Üí Application ‚Üí Cookies ‚Üí <code>sessionid</code> (do NOT url-decode)
                            </small>
                        </div>

                        <div id="username-fields" {% if cfg.mode == 'session' %}style="display:none;"{% endif %}>
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Username</label>
                                    <input type="text" name="username" class="form-control" placeholder="@yourusername" value="{{ cfg.username }}">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Password</label>
                                    <input type="password" name="password" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Target Thread ID <span class="text-danger">(required)</span></label>
                            <input type="number" name="thread_id" class="form-control" required
                                   placeholder="1234567890123456789" value="{{ cfg.thread_id }}">
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-bold">Messages (one per line)</label>
                            <textarea name="messages" class="form-control" rows="6" required
                                      placeholder="Hey bro\nWhat's up?\nSpam line 3">{{ cfg.messages }}</textarea>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <label class="form-label">Delay (seconds)</label>
                                <input type="number" step="0.5" name="delay" class="form-control" value="{{ cfg.delay }}" min="30">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Cycle (after X msgs)</label>
                                <input type="number" name="cycle" class="form-control" value="{{ cfg.cycle }}" min="5">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Break duration (sec)</label>
                                <input type="number" name="break" class="form-control" value="{{ cfg.break }}" min="60">
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-spam btn-lg px-5 me-3" id="startBtn">START BOMBING</button>
                            <a href="/stop" class="btn btn-outline-danger btn-lg px-5">STOP</a>
                        </div>
                    </form>
                </div>

                <div class="card p-3 shadow">
                    <h4 class="text-center mb-3 text-light">LIVE CONSOLE</h4>
                    <div class="console" id="console">
                        {% for log in logs %}
                            <div>{{ log }}</div>
                        {% endfor %}
                        {% if not logs %}
                            <div class="text-muted">[Waiting for activity...]</div>
                        {% endif %}
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        function toggleMode() {
            const mode = document.querySelector('[name="mode"]').value;
            document.getElementById('username-fields').style.display = mode === 'username' ? 'block' : 'none';
            document.getElementById('session-field').style.display = mode === 'session' ? 'block' : 'none';
        }
        toggleMode();

        function refreshConsole() {
            const consoleDiv = document.getElementById('console');
            consoleDiv.style.opacity = '0.7';
            
            fetch(window.location.href, { cache: 'no-store' })
                .then(r => r.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newContent = doc.getElementById('console').innerHTML;
                    
                    if (consoleDiv.innerHTML !== newContent) {
                        consoleDiv.innerHTML = newContent;
                        consoleDiv.scrollTop = consoleDiv.scrollHeight;
                    }
                    consoleDiv.style.opacity = '1';
                })
                .catch(err => {
                    consoleDiv.innerHTML += '<div class="text-danger">[Refresh failed]</div>';
                    consoleDiv.style.opacity = '1';
                });
        }

        // Refresh every 4 seconds
        setInterval(refreshConsole, 4000);
        // Initial refresh
        refreshConsole();
    </script>
</body>
</html>
